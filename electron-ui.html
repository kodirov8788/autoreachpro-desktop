<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AutoReach Pro デスクトップ</title>
    <link rel="icon" type="image/png" href="logo-black.png">
    <style>
      /* Design System Variables */
      :root {
        /* Colors */
        --primary-50: #f0f4ff;
        --primary-100: #e0e7ff;
        --primary-500: #6366f1;
        --primary-600: #4f46e5;
        --primary-700: #4338ca;
        --primary-900: #312e81;
        
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
        
        --success-50: #f0fdf4;
        --success-500: #22c55e;
        --success-600: #16a34a;
        
        --error-50: #fef2f2;
        --error-500: #ef4444;
        --error-600: #dc2626;
        
        --warning-50: #fffbeb;
        --warning-500: #f59e0b;
        --warning-600: #d97706;
        
        /* Typography */
        --font-size-xs: 0.75rem;
        --font-size-sm: 0.875rem;
        --font-size-base: 1rem;
        --font-size-lg: 1.125rem;
        --font-size-xl: 1.25rem;
        --font-size-2xl: 1.5rem;
        --font-size-3xl: 1.875rem;
        
        /* Spacing */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.25rem;
        --space-6: 1.5rem;
        --space-8: 2rem;
        --space-10: 2.5rem;
        --space-12: 3rem;
        --space-16: 4rem;
        
        /* Border Radius */
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        
        /* Shadows */
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      }

      /* Reset and Base Styles */
      * {
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background: var(--gray-50);
        margin: 0;
        padding: 0;
        color: var(--gray-900);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      /* .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        padding: 40px;
        max-width: 1200px;
        width: 90%;
        text-align: center;
        border: 10px solid #dee2e6;
      } */
      .logo {
        max-height: 60px;
        width: auto;
        margin-bottom: 10px;
        display: block;
      }
      .subtitle {
        color: #666;
        font-size: 1.1rem;
        margin-bottom: 30px;
      }
      .success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        color: #155724;
      }
      .status {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        border-left: 5px solid #28a745;
      }
      .btn {
        padding: 12px 20px;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        background: #667eea;
        color: white;
        margin: 10px;
      }
      .btn:hover {
        background: #5a6fd8;
      }
      .info {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        color: #1976d2;
      }
      .pairing-section {
        margin-top: 20px;
        padding: 20px;
        background: #f0f8ff;
        border-radius: 10px;
        border: 1px solid #a7d9ff;
      }
      #pairingCodeInput {
        padding: 10px;
        font-size: 1.2rem;
        text-align: center;
        border: 2px solid #667eea;
        border-radius: 8px;
        margin: 10px;
        width: 200px;
      }
      .connection-controls {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        border-left: 5px solid #17a2b8;
      }
      .controls-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 15px;
      }
      .control-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .control-group label {
        font-weight: 600;
        color: #495057;
      }
      .control-group select {
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        background: white;
      }
      .btn-small {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        background: #6c757d;
        color: white;
        margin: 2px;
      }
      .btn-small:hover {
        opacity: 0.9;
      }
      .btn-warning {
        background: #ffc107;
        color: #212529;
      }
      .btn-danger {
        background: #dc3545;
      }
      .btn-success {
        background: #28a745;
      }
      .connections-list {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        border-left: 5px solid #28a745;
      }
      .connection-item {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .connection-info {
        flex: 1;
      }
      .connection-status {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 600;
      }
      .status-authenticated {
        background: #d4edda;
        color: #155724;
      }
      .status-pending {
        background: #fff3cd;
        color: #856404;
      }
      .no-connections {
        text-align: center;
        color: #6c757d;
        font-style: italic;
      }
      .server-toggle {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        border-left: 5px solid #dc3545;
        text-align: center;
      }
      .toggle-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }
      .btn-toggle {
        padding: 15px 30px;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s ease;
        min-width: 200px;
        justify-content: center;
      }
      .btn-toggle:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      .btn-toggle-small {
        padding: 8px 12px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: auto;
        width: 40px;
        height: 40px;
      }
      /* Settings Section */
      .settings-section {
        margin: var(--space-8) 0;
      }
      
      .settings-content {
        margin-top: var(--space-4);
        padding: var(--space-6);
        background: var(--gray-50);
        border-radius: var(--radius-lg);
        border: 1px solid var(--gray-200);
        box-shadow: var(--shadow-sm);
      }
      /* Layout Components */
      .app-layout {
        display: flex;
        height: 100vh;
        width: 100%;
        background: var(--gray-50);
        overflow: hidden;
      }
      
      .sidebar {
        width: 280px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        display: flex;
        flex-direction: column;
        border-right: 1px solid var(--gray-200);
        box-shadow: var(--shadow-lg);
      }
      
      .sidebar-header {
        padding: var(--space-6);
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }
      
      .sidebar-header .logo {
        max-height: 50px;
        width: auto;
        margin: 0;
        filter: none;
        display: block;
        object-fit: contain;
        background: transparent;
      }
      
      .sidebar-content {
        padding: var(--space-6);
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: var(--space-6);
      }
      /* Server Status Component */
      .server-status {
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: var(--radius-lg);
        padding: var(--space-5);
        backdrop-filter: blur(10px);
      }
      
      .status-item {
        display: flex;
        align-items: center;
        margin-bottom: var(--space-3);
        font-size: var(--font-size-sm);
      }
      
      .status-item:last-child {
        margin-bottom: 0;
      }
      
      .status-icon {
        margin-right: var(--space-3);
        font-size: var(--font-size-base);
        width: 20px;
        text-align: center;
      }
      
      .status-text {
        font-weight: 600;
        color: white;
      }
      
      .status-label {
        font-weight: 500;
        margin-right: var(--space-2);
        opacity: 0.8;
        color: rgba(255, 255, 255, 0.9);
      }
      
      /* Main Content Area */
      .main-content {
        flex: 1;
        overflow-y: auto;
        background: var(--gray-50);
        padding: var(--space-8);
      }
      
      .server-toggle-sidebar {
        display: flex;
        justify-content: center;
      }
      /* Button Components */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-3) var(--space-5);
        border: none;
        border-radius: var(--radius-md);
        font-size: var(--font-size-sm);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
        gap: var(--space-2);
        min-height: 40px;
      }
      
      .btn:focus {
        outline: 2px solid var(--primary-500);
        outline-offset: 2px;
      }
      
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      
      .btn-primary {
        background: var(--primary-600);
        color: white;
      }
      
      .btn-primary:hover:not(:disabled) {
        background: var(--primary-700);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }
      
      .btn-toggle-small {
        width: 48px;
        height: 48px;
        border-radius: var(--radius-lg);
        padding: 0;
        border: 2px solid transparent;
        transition: all 0.2s ease;
      }
      
      .btn-toggle-small:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }
      
      .btn-off {
        background: var(--error-500);
        color: white;
      }
      
      .btn-off:hover:not(:disabled) {
        background: var(--error-600);
      }
      
      .btn-on {
        background: var(--success-500);
        color: white;
      }
      
      .btn-on:hover:not(:disabled) {
        background: var(--success-600);
      }
      
      .toggle-icon {
        font-size: var(--font-size-lg);
      }
      
      /* Section Components */
      .tasks-section {
        background: white;
        border-radius: var(--radius-xl);
        padding: var(--space-8);
        margin-bottom: var(--space-8);
        border: 1px solid var(--gray-200);
        box-shadow: var(--shadow-sm);
        transition: box-shadow 0.2s ease;
      }
      
      .tasks-section:hover {
        box-shadow: var(--shadow-md);
      }
      
      .tasks-section h3 {
        margin: 0 0 var(--space-6) 0;
        font-size: var(--font-size-xl);
        font-weight: 700;
        color: var(--gray-900);
        display: flex;
        align-items: center;
        gap: var(--space-3);
      }
      /* Task and List Components */
      .task-item {
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-lg);
        padding: var(--space-5);
        margin-bottom: var(--space-4);
        box-shadow: var(--shadow-sm);
        transition: all 0.2s ease;
      }
      
      .task-item:hover {
        box-shadow: var(--shadow-md);
        border-color: var(--gray-300);
      }
      
      .task-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-3);
      }
      
      .task-text {
        font-weight: 600;
        color: var(--gray-900);
        font-size: var(--font-size-base);
        line-height: 1.5;
      }
      
      .task-timestamp {
        font-size: var(--font-size-xs);
        color: var(--gray-500);
        margin-top: var(--space-2);
      }
      
      .task-connection {
        font-size: var(--font-size-xs);
        color: var(--gray-500);
        margin-top: var(--space-1);
      }
      
      .no-tasks {
        text-align: center;
        color: var(--gray-500);
        font-style: italic;
        padding: var(--space-8);
        background: var(--gray-50);
        border-radius: var(--radius-lg);
        border: 2px dashed var(--gray-300);
      }
      /* Badge Components */
      .task-badge {
        background: var(--primary-500);
        color: white;
        padding: var(--space-1) var(--space-3);
        border-radius: var(--radius-sm);
        font-size: var(--font-size-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.025em;
      }
      
      /* Form Components */
      .contact-form-controls {
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-lg);
        padding: var(--space-6);
        margin-bottom: var(--space-6);
      }
      
      .form-group {
        margin-bottom: var(--space-5);
      }
      
      .form-group:last-child {
        margin-bottom: 0;
      }
      
      .form-group label {
        display: block;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: var(--space-2);
        font-size: var(--font-size-sm);
      }
      
      .url-input,
      .text-input {
        width: 100%;
        padding: var(--space-3) var(--space-4);
        border: 1px solid var(--gray-300);
        border-radius: var(--radius-md);
        font-size: var(--font-size-sm);
        background: white;
        color: var(--gray-900);
        transition: all 0.2s ease;
      }
      
      .url-input:focus,
      .text-input:focus {
        outline: none;
        border-color: var(--primary-500);
        box-shadow: 0 0 0 3px var(--primary-100);
      }
      
      .url-input::placeholder,
      .text-input::placeholder {
        color: var(--gray-400);
      }
      /* Status Display Components */
      .status-display {
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-lg);
        padding: var(--space-5);
        margin-top: var(--space-5);
      }
      
      .status-display p {
        margin: 0;
        font-weight: 500;
        font-size: var(--font-size-sm);
      }
      
      .status-success {
        background: var(--success-50);
        border-color: var(--success-500);
        color: var(--success-600);
      }
      
      .status-error {
        background: var(--error-50);
        border-color: var(--error-500);
        color: var(--error-600);
      }
      
      .status-info {
        background: var(--primary-50);
        border-color: var(--primary-500);
        color: var(--primary-700);
      }
      /* Waiting List Components */
      .waiting-list-item {
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-lg);
        padding: var(--space-6);
        margin-bottom: var(--space-4);
        box-shadow: var(--shadow-sm);
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: var(--space-4);
        transition: all 0.2s ease;
      }
      
      .waiting-list-item:hover {
        box-shadow: var(--shadow-md);
        border-color: var(--gray-300);
      }
      
      .waiting-list-info {
        flex: 1;
        min-width: 0;
      }
      
      .waiting-list-url {
        font-weight: 600;
        color: var(--gray-900);
        font-size: var(--font-size-base);
        margin-bottom: var(--space-2);
        word-break: break-all;
        line-height: 1.4;
      }
      
      .waiting-list-business {
        font-size: var(--font-size-sm);
        color: var(--gray-600);
        margin-bottom: var(--space-2);
      }
      
      .waiting-list-timestamp {
        font-size: var(--font-size-xs);
        color: var(--gray-500);
      }
      
      .waiting-list-actions {
        display: flex;
        gap: var(--space-2);
        align-items: center;
        flex-shrink: 0;
      }
      /* Action Button Variants */
      .btn-send {
        background: var(--success-500);
        color: white;
        border: none;
        padding: var(--space-2) var(--space-4);
        border-radius: var(--radius-md);
        font-size: var(--font-size-xs);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        min-height: 32px;
      }
      
      .btn-send:hover:not(:disabled) {
        background: var(--success-600);
        transform: translateY(-1px);
        box-shadow: var(--shadow-sm);
      }
      
      .btn-send:disabled {
        background: var(--gray-400);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }
      
      .btn-see-message {
        background: var(--primary-500);
        color: white;
        border: none;
        padding: var(--space-2) var(--space-4);
        border-radius: var(--radius-md);
        cursor: pointer;
        font-size: var(--font-size-xs);
        font-weight: 600;
        transition: all 0.2s ease;
        min-height: 32px;
      }
      
      .btn-see-message:hover:not(:disabled) {
        background: var(--primary-600);
        transform: translateY(-1px);
        box-shadow: var(--shadow-sm);
      }
      
      .btn-see-message:disabled {
        background: var(--gray-400);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }
      
      .btn-remove {
        background: var(--error-500);
        color: white;
        border: none;
        padding: var(--space-2) var(--space-3);
        border-radius: var(--radius-md);
        font-size: var(--font-size-xs);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        min-height: 32px;
        min-width: 32px;
      }
      
      .btn-remove:hover:not(:disabled) {
        background: var(--error-600);
        transform: translateY(-1px);
        box-shadow: var(--shadow-sm);
      }
      /* Status Badge Components */
      .status-badge {
        padding: var(--space-1) var(--space-3);
        border-radius: var(--radius-sm);
        font-size: var(--font-size-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.025em;
      }
      
      .status-pending {
        background: var(--warning-50);
        color: var(--warning-600);
        border: 1px solid var(--warning-200);
      }
      
      .status-processing {
        background: var(--primary-50);
        color: var(--primary-600);
        border: 1px solid var(--primary-200);
      }
      
      .status-completed {
        background: var(--success-50);
        color: var(--success-600);
        border: 1px solid var(--success-200);
      }
      
      .status-error {
        background: var(--error-50);
        color: var(--error-600);
        border: 1px solid var(--error-200);
      }
      /* Countdown Timer Component */
      .countdown-timer {
        background: var(--warning-50);
        border: 1px solid var(--warning-200);
        border-radius: var(--radius-md);
        padding: var(--space-3) var(--space-4);
        margin: var(--space-3) 0;
        text-align: center;
        font-weight: 600;
        color: var(--warning-600);
        font-size: var(--font-size-sm);
        animation: pulse 2s infinite;
      }
      
      @keyframes pulse {
        0%, 100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }
      
      .countdown-number {
        font-size: var(--font-size-lg);
        font-weight: 700;
        color: var(--error-500);
      }

      /* Modal Components */
      .message-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-6);
        box-sizing: border-box;
      }

      .message-modal-content {
        background: white;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xl);
        max-width: 800px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        animation: modalSlideIn 0.3s ease-out;
        border: 1px solid var(--gray-200);
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-20px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-6);
        border-bottom: 1px solid var(--gray-200);
        background: var(--gray-50);
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
      }

      .modal-header h3 {
        margin: 0;
        color: var(--gray-900);
        font-size: var(--font-size-xl);
        font-weight: 700;
      }

      .close-button {
        background: none;
        cursor: pointer;
        border: none;
        font-size: var(--font-size-lg);
        color: var(--gray-500);
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius-md);
        transition: all 0.2s ease;
      }

      .close-button:hover {
        background: var(--gray-200);
        color: var(--gray-700);
      }

      .modal-body {
        padding: var(--space-6);
      }

      .message-field {
        margin-bottom: var(--space-6);
      }

      .message-field label {
        display: block;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: var(--space-3);
        font-size: var(--font-size-sm);
      }

      .message-subject {
        display: block;
        padding: var(--space-4);
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-md);
        color: var(--gray-900);
        font-weight: 500;
        font-size: var(--font-size-sm);
        line-height: 1.5;
      }

      .message-content {
        width: 100%;
        min-height: 120px;
        padding: var(--space-4);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-md);
        font-family: inherit;
        font-size: var(--font-size-sm);
        line-height: 1.6;
        background: var(--gray-50);
        color: var(--gray-900);
        resize: vertical;
        transition: all 0.2s ease;
      }

      .message-content:focus {
        outline: none;
        border-color: var(--primary-500);
        box-shadow: 0 0 0 3px var(--primary-100);
        background: white;
      }

      .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: var(--space-3);
        padding: var(--space-6);
        border-top: 1px solid var(--gray-200);
        background: var(--gray-50);
        border-radius: 0 0 var(--radius-xl) var(--radius-xl);
      }

      .btn-secondary {
        background: var(--gray-500);
        color: white;
        border: none;
        padding: var(--space-3) var(--space-5);
        border-radius: var(--radius-md);
        cursor: pointer;
        font-size: var(--font-size-sm);
        font-weight: 600;
        transition: all 0.2s ease;
        min-height: 40px;
      }

      .btn-secondary:hover:not(:disabled) {
        background: var(--gray-600);
        transform: translateY(-1px);
        box-shadow: var(--shadow-sm);
      }

      /* Enhanced Message Modal Styles */
      .message-info {
        background: var(--primary-50);
        border: 1px solid var(--primary-200);
        border-radius: var(--radius-lg);
        padding: var(--space-4);
        margin-bottom: var(--space-6);
        text-align: center;
      }

      .message-info .message-source {
        margin: 0;
        color: var(--primary-700);
        font-weight: 600;
        font-size: var(--font-size-sm);
      }

      .message-note {
        background: var(--warning-50);
        border: 1px solid var(--warning-200);
        border-radius: var(--radius-md);
        padding: var(--space-4);
        margin-top: var(--space-5);
      }

      .message-note p {
        margin: 0;
        color: var(--warning-700);
        font-size: var(--font-size-sm);
        font-style: italic;
        line-height: 1.5;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .app-layout {
          flex-direction: column;
        }
        
        .sidebar {
        width: 100%;
          height: auto;
          border-right: none;
          border-bottom: 1px solid var(--gray-200);
        }
        
        .main-content {
          padding: var(--space-4);
        }
        
        .waiting-list-item {
          flex-direction: column;
          align-items: stretch;
          gap: var(--space-4);
        }
        
        .waiting-list-actions {
          justify-content: flex-start;
          flex-wrap: wrap;
        }
        
        .message-modal-content {
          margin: var(--space-4);
          max-width: calc(100% - var(--space-8));
        }
      }

      /* Accessibility Improvements */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* High Contrast Mode Support */
      @media (prefers-contrast: high) {
        :root {
          --gray-200: #000000;
          --gray-300: #000000;
          --gray-400: #000000;
          --gray-500: #000000;
          --gray-600: #000000;
          --gray-700: #000000;
          --gray-800: #000000;
          --gray-900: #000000;
        }
      }

      /* Focus Management */
      .btn:focus-visible,
      .url-input:focus-visible,
      .text-input:focus-visible,
      .message-content:focus-visible {
        outline: 2px solid var(--primary-500);
        outline-offset: 2px;
      }

      /* Print Styles */
      @media print {
        .sidebar,
        .btn,
        .modal-overlay {
          display: none !important;
        }
        
        .main-content {
          padding: 0;
          background: white;
        }
        
        .tasks-section {
          box-shadow: none;
          border: 1px solid #000;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-layout">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-header">
      <img src="logo-black.png" alt="AutoReach Pro" class="logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
      <div class="logo-text" style="display: none; font-size: var(--font-size-xl); font-weight: 700; color: white; margin: 0;">AutoReach Pro</div>
      </div>
        <div class="sidebar-content">
          <div class="server-status" id="serverStatus">
            <div class="status-item">
              <span class="status-icon">🔴</span>
              <span class="status-text">WebSocketサーバー OFF</span>
      </div>
            <div class="status-item">
              <span class="status-label">ステータス:</span>
              <span id="serverStatusText">無効</span>
            </div>
      </div>

          <!-- Server Toggle Button -->
          <div class="server-toggle-sidebar">
          <button
              class="btn-toggle-small btn-off"
            id="toggleButton"
            onclick="toggleServer()"
              title="WebSocketサーバーの切り替え"
          >
            <span class="toggle-icon">🔴</span>
          </button>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <div class="container">

      <!-- Contact Form Waiting List -->
      <div class="tasks-section" id="waitingListSection">
        <h3>⏳ お問い合わせフォーム待機リスト</h3>
        <div id="waitingListContainer">
          <p class="no-tasks">待機リストにURLがありません</p>
        </div>
      </div>




      <!-- Settings Section -->
      <div class="settings-section">
        <button class="btn" onclick="toggleSettings()">⚙️ 設定</button>
        <div
          class="settings-content"
          id="settingsContent"
          style="display: none"
        >
      <!-- Tasks from Website -->
      <div class="tasks-section" id="tasksSection">
            <h3>📋 ウェブサイトからのタスク</h3>
        <div id="tasksContainer">
              <p class="no-tasks">まだタスクが受信されていません</p>
        </div>
      </div>

      <!-- Direct Contact Form Automation -->
      <div class="tasks-section" id="contactFormSection">
            <h3>📝 直接お問い合わせフォーム自動化</h3>
        <div class="contact-form-controls">
          <div class="form-group">
                <label for="contactUrlInput">お問い合わせページURL:</label>
            <input
              type="url"
              id="contactUrlInput"
              placeholder="https://example.com/contact"
              class="url-input"
            />
          </div>
          <div class="form-group">
                <label for="businessNameInput">事業者名:</label>
            <input
              type="text"
              id="businessNameInput"
                  placeholder="事業者名"
              class="text-input"
            />
          </div>
              <div class="form-group">
                <label for="contactNameInput">お名前:</label>
                <input
                  type="text"
                  id="contactNameInput"
                  placeholder="お名前"
                  class="text-input"
                />
              </div>
              <div class="form-group">
                <label for="contactEmailInput">メールアドレス:</label>
                <input
                  type="email"
                  id="contactEmailInput"
                  placeholder="your@email.com"
                  class="text-input"
                />
              </div>
              <div class="form-group">
                <label for="contactPhoneInput">電話番号:</label>
                <input
                  type="tel"
                  id="contactPhoneInput"
                  placeholder="+1 (555) 123-4567"
                  class="text-input"
                />
              </div>
              <div class="form-group">
                <label for="contactMessageInput">メッセージ:</label>
                <textarea
                  id="contactMessageInput"
                  placeholder="メッセージを入力してください..."
                  rows="4"
                  class="text-input"
                ></textarea>
              </div>
              <button class="btn" onclick="automateContactForm()">
                🚀 お問い合わせフォーム自動化
          </button>
        </div>
            <div class="contact-form-status">
              <p id="contactFormStatusText">送信準備完了</p>
        </div>
      </div>

        </div>
      </div>

 
 
    </div>
    </div>

    <script>
      // Initialize the app when DOM is loaded
      document.addEventListener("DOMContentLoaded", function () {
        initializeApp();
      });

      async function initializeApp() {
        try {
          // Listen for server started event
          if (window.electronAPI) {
            window.electronAPI.onServerStarted((event, data) => {
              console.log("Server started:", data);
              updateServerStatus(data);
            });

            // Listen for real-time status updates
            window.electronAPI.onStatusUpdate((event, data) => {
              console.log("Status update:", data);
              updateServerStatus(data);
              updateConnectionsList(data.connections || []);
            });

            // Listen for task-received events
            window.electronAPI.onTaskReceived((event, taskData) => {
              console.log("Task received:", taskData);
              addTaskToUI(taskData);
            });

            // Listen for contact form automation results
            window.electronAPI.onContactFormResult((event, result) => {
              console.log("Contact form result:", result);
              handleContactFormResult(result);
            });

            // Listen for waiting list updates
            window.electronAPI.onWaitingListUpdate((event, data) => {
              console.log("Waiting list update:", data);
              updateWaitingList(data);
            });

            // Get initial server status
            const status = await window.electronAPI.getServerStatus();
            updateServerStatus(status);
            updateConnectionsList(status.connections || []);
          } else {
            console.log("Electron API not available, using fallback");
            updateServerStatus({
              serverEnabled: false,
              port: null,
              connections: 0,
              authenticatedConnections: 0,
              uptime: 0,
            });
          }
        } catch (error) {
          console.error("Error initializing app:", error);
          updateServerStatus({
            serverEnabled: false,
            port: null,
            connections: 0,
            authenticatedConnections: 0,
            uptime: 0,
          });
        }
      }

      function updateServerStatus(data) {
        const statusContainer = document.getElementById("serverStatus");
        const toggleButton = document.getElementById("toggleButton");
        const toggleStatus = document.getElementById("toggleStatus");

        // Update server status display
        if (data.serverEnabled) {
          statusContainer.innerHTML = `
            <div class="status-item">
              <span class="status-icon">🟢</span>
              <span class="status-text">WebSocketサーバー 稼働中</span>
            </div>
            <div class="status-item">
              <span class="status-label">ポート:</span>
              <span>${data.port}</span>
            </div>
            <div class="status-item">
              <span class="status-label">ステータス:</span>
              <span>稼働中</span>
            </div>
          `;

          // Update toggle button to OFF state
          if (toggleButton) {
            toggleButton.className = "btn-toggle-small btn-on";
            toggleButton.innerHTML = '<span class="toggle-icon">🟢</span>';
          }
        } else {
          statusContainer.innerHTML = `
            <div class="status-item">
              <span class="status-icon">🔴</span>
              <span class="status-text">WebSocketサーバー OFF</span>
            </div>
            <div class="status-item">
              <span class="status-label">ステータス:</span>
              <span>Disabled</span>
            </div>
          `;

          // Update toggle button to ON state
          if (toggleButton) {
            toggleButton.className = "btn-toggle-small btn-off";
            toggleButton.innerHTML = '<span class="toggle-icon">🔴</span>';
          }
        }
      }

      function formatUptime(ms) {
        if (!ms) return "0s";
        const seconds = Math.floor(ms / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);

        if (hours > 0) {
          return `${hours}h ${minutes % 60}m ${seconds % 60}s`;
        } else if (minutes > 0) {
          return `${minutes}m ${seconds % 60}s`;
        } else {
          return `${seconds}s`;
        }
      }

      function updateConnectionsList(connections) {
        const container = document.getElementById("connectionsContainer");
        if (!container) return;

        if (!connections || connections.length === 0) {
          container.innerHTML =
            '<p class="no-connections">No active connections</p>';
          return;
        }

        container.innerHTML = connections
          .map(
            (conn) => `
          <div class="connection-item">
            <div class="connection-info">
              <div><strong>${conn.remoteAddress}</strong></div>
              <div class="text-sm text-gray-600">
                Connected: ${new Date(conn.connectedAt).toLocaleTimeString()}
              </div>
              <div class="text-sm text-gray-600">
                Last Activity: ${new Date(
                  conn.lastActivity
                ).toLocaleTimeString()}
              </div>
            </div>
            <div class="connection-status ${
              conn.isAuthenticated ? "status-authenticated" : "status-pending"
            }">
              ${conn.isAuthenticated ? "Authenticated" : "Pending"}
            </div>
          </div>
        `
          )
          .join("");
      }

      // WebSocket-based pairing code validation
      async function validatePairingCodeViaWebSocket(code) {
        return new Promise((resolve, reject) => {
          // Try different ports where WebSocket server might be running
          const ports = [3002, 3003, 3004, 3005];
          let currentPortIndex = 0;

          function tryNextPort() {
            if (currentPortIndex >= ports.length) {
              reject(new Error("WebSocket server not found on any port"));
              return;
            }

            const port = ports[currentPortIndex];
            const ws = new WebSocket(`ws://localhost:${port}`);

            const timeout = setTimeout(() => {
              ws.close();
              currentPortIndex++;
              tryNextPort();
            }, 3000);

            ws.onopen = () => {
              console.log(`✅ Connected to WebSocket server on port ${port}`);
              clearTimeout(timeout);

              // Send pairing request
              ws.send(
                JSON.stringify({
                  type: "pairing_request",
                  data: { code: code },
                  timestamp: Date.now(),
                })
              );
            };

            ws.onmessage = (event) => {
              try {
                const message = JSON.parse(event.data);
                console.log("📨 Received WebSocket response:", message);

                if (message.type === "pairing_response") {
                  clearTimeout(timeout);
                  ws.close();

                  if (message.data.success) {
                    console.log("🎉 Pairing successful via WebSocket");
                    resolve({
                      success: true,
                      sessionToken: message.data.sessionToken,
                      connectionId: message.data.connectionId,
                    });
                  } else {
                    resolve({
                      success: false,
                      error: message.data.message || "Invalid code",
                    });
                  }
                }
              } catch (error) {
                console.error("Error parsing WebSocket message:", error);
                clearTimeout(timeout);
                ws.close();
                currentPortIndex++;
                tryNextPort();
              }
            };

            ws.onerror = (error) => {
              console.log(`❌ WebSocket error on port ${port}:`, error);
              clearTimeout(timeout);
              currentPortIndex++;
              tryNextPort();
            };

            ws.onclose = () => {
              clearTimeout(timeout);
            };
          }

          tryNextPort();
        });
      }

      async function enterPairingCode() {
        const input = document.getElementById("pairingCodeInput");
        const code = input.value.trim();

        if (!code) {
          alert("ペアリングコードを入力してください");
          return;
        }

        if (!/^\d{6}$/.test(code)) {
          alert("有効な6桁のペアリングコードを入力してください");
          return;
        }

        try {
          // Try WebSocket connection first (for WebSocket-only mode)
          const result = await validatePairingCodeViaWebSocket(code);
          if (result.success) {
            alert(
              "✅ ペアリングコード " +
                code +
                " が検証されました！\n\nデスクトップアプリがウェブアプリケーションに接続されました。\n自動化機能を使用できます。"
            );

            // Update UI to show connected state
            const statusContainer = document.getElementById("serverStatus");
            statusContainer.innerHTML = `
              <h3>✅ ウェブサイトに接続済み！</h3>
              <p>AutoReach Proウェブサイトとのペアリングが成功しました</p>
              <p><strong>ペアリングコード:</strong> ${code}</p>
              <p><strong>ステータス:</strong> <span style="color: green;">接続済み</span></p>
            `;
            input.value = "";
          } else {
            alert("❌ " + result.error);
          }
        } catch (error) {
          console.error("Error validating pairing code:", error);
          alert("❌ Error validating pairing code: " + error.message);
        }
      }

      // Server toggle function
      async function toggleServer() {
        if (window.electronAPI) {
          try {
            const result = await window.electronAPI.toggleServer();
            if (result.success) {
              // Status will be updated via the status-update event
              console.log("Server toggled:", result.message);
            } else {
              alert(`❌ サーバーの切り替えに失敗しました: ${result.error}`);
            }
          } catch (error) {
            alert(`❌ サーバーの切り替え中にエラーが発生しました: ${error.message}`);
          }
        } else {
          alert("❌ Electron APIが利用できません");
        }
      }

      // Task management functions
      let tasks = [];
      let waitingList = [];

      function addTaskToUI(taskData) {
        const container = document.getElementById("tasksContainer");
        if (!container) return;

        // Add task to array
        tasks.unshift({
          id: Date.now(),
          taskText: taskData.taskText,
          timestamp: taskData.timestamp,
          connectionId: taskData.connectionId,
          receivedAt: new Date().toISOString(),
        });

        // Keep only last 10 tasks
        if (tasks.length > 10) {
          tasks = tasks.slice(0, 10);
        }

        // Update UI
        updateTasksUI();
      }

      function updateTasksUI() {
        const container = document.getElementById("tasksContainer");
        if (!container) return;

        if (tasks.length === 0) {
          container.innerHTML = '<p class="no-tasks">No tasks received yet</p>';
          return;
        }

        container.innerHTML = tasks
          .map(
            (task) => `
          <div class="task-item">
            <div class="task-header">
              <div class="task-text">${escapeHtml(task.taskText)}</div>
              <div class="task-badge">NEW</div>
            </div>
            <div class="task-timestamp">
              Received: ${new Date(task.receivedAt).toLocaleString()}
            </div>
            <div class="task-connection">
              Connection: ${task.connectionId}
            </div>
          </div>
        `
          )
          .join("");
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Contact form automation functions
      function sendContactForm() {
        const urlInput = document.getElementById("contactUrlInput");
        const businessNameInput = document.getElementById("businessNameInput");
        const sendBtn = document.getElementById("sendContactFormBtn");
        const statusDiv = document.getElementById("contactFormStatus");
        const statusText = document.getElementById("contactFormStatusText");

        const url = urlInput.value.trim();
        const businessName =
          businessNameInput.value.trim() || "Unknown Business";

        if (!url) {
          showContactFormStatus("Please enter a contact page URL", "error");
          return;
        }

        if (!isValidUrl(url)) {
          showContactFormStatus("Please enter a valid URL", "error");
          return;
        }

        // Disable button and show loading
        sendBtn.disabled = true;
        sendBtn.textContent = "🔄 Processing...";
        showContactFormStatus("Starting Puppeteer automation...", "info");

        // Send command to main process
        if (window.electronAPI) {
          window.electronAPI.sendContactFormAutomation({
            url: url,
            businessName: businessName,
            formData: {
              name: "AutoReach Pro User",
              email: "contact@autoreachpro.com",
              phone: "+1-555-0123",
              company: "AutoReach Pro",
            },
            subject: "Business Inquiry",
            message:
              "Hello! I'm interested in your services. Please contact me for more information.",
          });
        } else {
          showContactFormStatus("Electron API not available", "error");
          resetContactFormButton();
        }
      }

      function showContactFormStatus(message, type) {
        const statusDiv = document.getElementById("contactFormStatus");
        const statusText = document.getElementById("contactFormStatusText");

        statusText.textContent = message;
        statusDiv.className = `status-display status-${type}`;
        statusDiv.style.display = "block";
      }

      function resetContactFormButton() {
        const sendBtn = document.getElementById("sendContactFormBtn");
        sendBtn.disabled = false;
        sendBtn.textContent = "🚀 Send Contact Form";
      }

      function isValidUrl(string) {
        try {
          new URL(string);
          return true;
        } catch (_) {
          return false;
        }
      }

      function handleContactFormResult(result) {
        resetContactFormButton();

        if (result.success) {
          showContactFormStatus(
            `✅ Success! Chrome opened with contact form. Business: ${result.businessName}`,
            "success"
          );
        } else {
          showContactFormStatus(`❌ Error: ${result.error}`, "error");
        }
      }

      // Waiting list management functions
      let countdownTimers = {};

      function updateWaitingList(data) {
        if (data.action === "add") {
          const newItem = {
            id: data.id,
            url: data.url,
            businessName: data.businessName,
            subject: data.subject || "",
            message: data.message || "",
            status: "pending",
            timestamp: new Date().toISOString(),
            addedAt: new Date().toLocaleString(),
            countdown: 3,
          };
          waitingList.unshift(newItem);

          // Start countdown timer for this item
          startCountdownTimer(data.id);
        } else if (data.action === "update") {
          const index = waitingList.findIndex((item) => item.id === data.id);
          if (index !== -1) {
            waitingList[index].status = data.status;
            if (data.result) {
              waitingList[index].result = data.result;
            }
            // Clear countdown when status changes
            if (data.status !== "pending") {
              clearCountdownTimer(data.id);
            }
          }
        } else if (data.action === "remove") {
          clearCountdownTimer(data.id);
          waitingList = waitingList.filter((item) => item.id !== data.id);
        }

        renderWaitingList();
      }

      function startCountdownTimer(itemId) {
        // Clear any existing timer for this item
        clearCountdownTimer(itemId);

        let countdown = 3;
        countdownTimers[itemId] = setInterval(() => {
          const item = waitingList.find((item) => item.id === itemId);
          if (item && item.status === "pending") {
            item.countdown = countdown;
            renderWaitingList();
            countdown--;

            if (countdown < 0) {
              clearCountdownTimer(itemId);
            }
          } else {
            clearCountdownTimer(itemId);
          }
        }, 1000);
      }

      function clearCountdownTimer(itemId) {
        if (countdownTimers[itemId]) {
          clearInterval(countdownTimers[itemId]);
          delete countdownTimers[itemId];
        }
      }

      function renderWaitingList() {
        const container = document.getElementById("waitingListContainer");
        if (!container) return;

        if (waitingList.length === 0) {
          container.innerHTML =
            '<p class="no-tasks">No URLs in waiting list</p>';
          return;
        }

        container.innerHTML = waitingList
          .map(
            (item) => `
          <div class="waiting-list-item">
            <div class="waiting-list-info">
              <div class="waiting-list-url">${escapeHtml(item.url)}</div>
              <div class="waiting-list-business">Business: ${escapeHtml(
                item.businessName
              )}</div>
              <div class="waiting-list-timestamp">Added: ${item.addedAt}</div>
              ${
                item.status === "pending" && item.countdown !== undefined
                  ? `
                <div class="countdown-timer">
                  ⏰ Auto-sending in <span class="countdown-number">${item.countdown}</span> seconds
                </div>
              `
                  : ""
              }
            </div>
            <div class="waiting-list-actions">
              <span class="status-badge status-${item.status}">${
              item.status
            }</span>
              <button 
                class="btn-see-message" 
                onclick="showMessageModal('${item.id}')"
                ${item.status === "processing" ? "disabled" : ""}
              >
                📖 See Message
              </button>
              <button 
                class="btn-send" 
                onclick="sendWaitingListItem('${item.id}')"
                ${item.status === "processing" ? "disabled" : ""}
              >
                ${
                  item.status === "processing"
                    ? "🔄 Processing..."
                    : "🚀 Send Now"
                }
              </button>
              <button 
                class="btn-remove" 
                onclick="removeWaitingListItem('${item.id}')"
                ${item.status === "processing" ? "disabled" : ""}
              >
                ❌
              </button>
            </div>
          </div>
        `
          )
          .join("");
      }

      function sendWaitingListItem(itemId) {
        const item = waitingList.find((item) => item.id === itemId);
        if (!item) return;

        // Update status to processing
        item.status = "processing";
        renderWaitingList();

        // Send to main process
        if (window.electronAPI) {
          window.electronAPI.sendContactFormAutomation({
            url: item.url,
            businessName: item.businessName,
            formData: {
              name: "AutoReach Pro User",
              email: "contact@autoreachpro.com",
              phone: "+1-555-0123",
              company: "AutoReach Pro",
            },
            subject: item.subject || "Business Inquiry",
            message:
              item.message ||
              "Hello! I'm interested in your services. Please contact me for more information.",
            waitingListItemId: itemId,
          });
        }
      }

      function removeWaitingListItem(itemId) {
        waitingList = waitingList.filter((item) => item.id !== itemId);
        renderWaitingList();
      }

      function toggleSettings() {
        const settingsContent = document.getElementById("settingsContent");
        if (settingsContent.style.display === "none") {
          settingsContent.style.display = "block";
        } else {
          settingsContent.style.display = "none";
        }
      }

      // Message Modal Functions
      function showMessageModal(itemId) {
        const item = waitingList.find((item) => item.id === itemId);
        if (!item) return;

        const modalHtml = `
          <div class="message-modal-overlay" onclick="closeMessageModal()">
            <div class="message-modal-content" onclick="event.stopPropagation()">
              <div class="modal-header">
                <h3>📖 Message Preview for ${escapeHtml(item.businessName)}</h3>
                <button class="close-button" onclick="closeMessageModal()">✕</button>
              </div>
              <div class="modal-body">
                <div class="message-info">
                  <p class="message-source">📀 Message data received from website</p>
                </div>
                <div class="message-field">
                  <label>Subject: ${
                    item.subject ? `(${item.subject.length} chars)` : "(empty)"
                  }</label>
                  <span class="message-subject">${escapeHtml(
                    item.subject || "⚠️ No subject provided"
                  )}</span>
                </div>
                <div class="message-field">
                  <label>Message: ${
                    item.message ? `(${item.message.length} chars)` : "(empty)"
                  }</label>
                  <textarea class="message-content" readonly placeholder="No message content available">${escapeHtml(
                    item.message || "⚠️ No message content provided"
                  )}</textarea>
                </div>
                <div class="message-note">
                  <p>💡 This content will be used to automatically fill the contact form on the website.</p>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn-secondary" onclick="closeMessageModal()">Close</button>
                <button class="btn-send" onclick="sendMessageFromModal('${itemId}')">🚀 Send with Puppeteer</button>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML("beforeend", modalHtml);

        // Close on Escape key
        document.addEventListener("keydown", handleEscapeKey);
      }

      function closeMessageModal() {
        const modal = document.querySelector(".message-modal-overlay");
        if (modal) {
          modal.remove();
        }
        document.removeEventListener("keydown", handleEscapeKey);
      }

      function handleEscapeKey(event) {
        if (event.key === "Escape") {
          closeMessageModal();
        }
      }

      function sendMessageFromModal(itemId) {
        closeMessageModal();
        sendWaitingListItem(itemId);
      }
    </script>
  </body>
</html>

